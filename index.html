<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Pro å°èˆªå„€ - å°ˆæ¥­åˆ†æå¸«å¢å¼·ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #050505; }
        .tab-active { border-bottom: 4px solid #eab308; color: #eab308; }
        .calc-input { background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 4px 8px; width: 120px; color: #eab308; font-weight: bold; }
        .progress-bar { transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="text-slate-200 p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <section class="mb-6 bg-gray-900/50 p-4 rounded-xl border border-gray-800">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-xs font-bold text-gray-400">ğŸŒ å…¨å¸‚å ´è·¯æ³çµ±è¨ˆ (å‰50å¤§å¹£ç¨®)</h3>
                <span id="market-status-text" class="text-xs font-bold">æƒæä¸­...</span>
            </div>
            <div class="w-full bg-red-900/30 h-4 rounded-full overflow-hidden flex">
                <div id="bull-bar" class="bg-green-500 h-full progress-bar" style="width: 50%"></div>
                <div id="bear-bar" class="bg-red-500 h-full progress-bar" style="width: 50%"></div>
            </div>
            <div class="flex justify-between text-[10px] mt-1 text-gray-500 font-mono">
                <span>æ¼²å‹¢å®¶æ•¸: <span id="bull-count">0</span></span>
                <span>è·Œå‹¢å®¶æ•¸: <span id="bear-count">0</span></span>
            </div>
        </section>

        <header class="mb-8 bg-gray-900 border-2 border-yellow-600/50 p-6 rounded-2xl shadow-2xl flex flex-col md:flex-row justify-between items-center gap-6">
            <div>
                <h1 class="text-3xl font-black text-yellow-500 tracking-tighter italic">æ–°æ‰‹äº¤æ˜“å°èˆªå„€</h1>
                <p class="text-xs text-gray-400 mt-1">å°ˆæ¥­åŠŸèƒ½ï¼šç†±åŠ›åœ–ã€å¤šéšåœåˆ©ã€æƒ…ç·’éæ¿¾</p>
            </div>
            <div class="flex items-center gap-4 bg-black/50 p-4 rounded-xl border border-gray-800">
                <label class="text-sm font-bold">ğŸ’° ç¸½æœ¬é‡‘ (USDT):</label>
                <input type="number" id="total-capital" value="30" oninput="analyze()" class="calc-input text-xl">
            </div>
        </header>

        <nav class="flex space-x-10 mb-8 border-b border-gray-800 font-bold text-sm">
            <button onclick="switchTab('oversold')" id="btn-oversold" class="pb-3 tab-active">ğŸ’ æ’¿ä¾¿å®œå€</button>
            <button onclick="switchTab('breakout')" id="btn-breakout" class="pb-3 text-gray-500">ğŸš€ è¡åˆºå€</button>
            <button onclick="switchTab('all')" id="btn-all" class="pb-3 text-gray-500">ğŸ” å¸‚å ´å…¨æƒæ</button>
        </nav>

        <div id="oversold-section">
            <div id="oversold-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>
        <div id="breakout-section" class="hidden">
            <div id="breakout-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>
        <div id="all-section" class="hidden">
            <div class="bg-gray-900 rounded-xl overflow-hidden border border-gray-800">
                <table class="w-full text-left text-xs">
                    <thead class="bg-gray-800 text-gray-400 font-bold">
                        <tr><th class="p-4">è²¨å¹£</th><th class="p-4">åƒ¹æ ¼</th><th class="p-4">ç†±åº¦</th><th class="p-4">è·¯æ³</th><th class="p-4">æ“ä½œ</th></tr>
                    </thead>
                    <tbody id="full-tbody" class="divide-y divide-gray-800 font-mono"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        async function analyze() {
            const capital = parseFloat(document.getElementById('total-capital').value) || 0;
            const res = await fetch('https://api.binance.com/api/v3/ticker/24hr');
            const data = await res.json();
            const top50 = data.filter(d => d.symbol.endsWith('USDT')).sort((a, b) => b.quoteVolume - a.quoteVolume).slice(0, 50);

            // æ›´æ–°ç†±åŠ›åœ–
            const bulls = top50.filter(c => parseFloat(c.priceChangePercent) > 0).length;
            const bears = top50.length - bulls;
            document.getElementById('bull-bar').style.width = `${(bulls/50)*100}%`;
            document.getElementById('bull-count').innerText = bulls;
            document.getElementById('bear-count').innerText = bears;
            document.getElementById('market-status-text').innerText = bulls > 35 ? "ğŸ”¥ å¸‚å ´æ¥µåº¦æ¨‚è§€" : (bulls < 15 ? "ğŸ˜¨ å¸‚å ´æ¥µåº¦ææ…Œ" : "âš–ï¸ å¸‚å ´å¤šç©ºæ‹‰é‹¸");

            const oversoldList = document.getElementById('oversold-list');
            const breakoutList = document.getElementById('breakout-list');
            const fullTbody = document.getElementById('full-tbody');

            oversoldList.innerHTML = ''; breakoutList.innerHTML = ''; fullTbody.innerHTML = '';

            for (let coin of top50) {
                try {
                    const kRes = await fetch(`https://api.binance.com/api/v3/klines?symbol=${coin.symbol}&interval=1h&limit=200`);
                    const kData = await kRes.json();
                    const closes = kData.map(d => parseFloat(d[4]));
                    const volumes = kData.map(d => parseFloat(d[5]));
                    const price = closes[closes.length - 1];

                    const rsi = calcRSI(closes);
                    const ema200 = calcEMA(closes, 200);
                    const avgVol = volumes.slice(-20).reduce((a,b)=>a+b)/20;
                    const volConfirm = volumes[volumes.length - 1] > avgVol * 1.5;
                    const isAboveEMA = price > ema200;
                    const suggestAmount = (capital * 0.15).toFixed(2);

                    if (rsi < 32) {
                        oversoldList.innerHTML += createCard(coin.symbol, price, suggestAmount, true, volConfirm, isAboveEMA);
                    }
                    if (rsi > 68 && volConfirm) {
                        breakoutList.innerHTML += createCard(coin.symbol, price, suggestAmount, false, volConfirm, isAboveEMA);
                    }

                    fullTbody.innerHTML += `
                        <tr class="hover:bg-gray-800">
                            <td class="p-4 font-bold text-yellow-500">${coin.symbol}</td>
                            <td class="p-4">$${price}</td>
                            <td class="p-4 ${rsi < 32 ? 'text-green-400' : (rsi > 68 ? 'text-red-400' : 'text-gray-500')}">${rsi.toFixed(0)}</td>
                            <td class="p-4 ${isAboveEMA ? 'text-green-500' : 'text-red-500'} font-bold">${isAboveEMA ? 'âœ…ä¸Šå¡' : 'âŒä¸‹å¡'}</td>
                            <td class="p-4">${rsi < 32 ? 'æŠ„åº•' : (rsi > 68 ? 'è¿½æ¼²' : '-')}</td>
                        </tr>`;
                } catch(e) {}
            }
        }

        function createCard(symbol, price, amount, isOversold, volConfirm, isAboveEMA) {
            const isSafe = volConfirm && isAboveEMA;
            // åŠŸèƒ½ 2: å¤šéšåœåˆ©è¨ˆç®—
            const tp1 = (price * 1.04).toFixed(4);
            const tp2 = (price * 1.08).toFixed(4);
            const tp3 = (price * 1.15).toFixed(4);
            const stopLoss = (price * 0.97).toFixed(4);

            return `
                <div class="bg-gray-900 border-2 ${isSafe ? 'border-green-500' : 'border-yellow-600'} p-6 rounded-2xl shadow-xl">
                    <h3 class="text-2xl font-black mb-4">${symbol}</h3>
                    <div class="bg-yellow-500/10 border border-yellow-500/50 p-4 rounded-xl mb-4 text-center">
                        <p class="text-[10px] text-yellow-500 font-bold mb-1">æœ¬ç­†æ¨è–¦æŠ•å…¥</p>
                        <p class="text-3xl font-black text-white">$ ${amount}</p>
                    </div>

                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between text-xs text-red-500 font-bold"><span>ğŸš¨ å¼·åˆ¶åœæåƒ¹:</span><span>$${stopLoss}</span></div>
                        <div class="space-y-1 mt-4 border-t border-gray-800 pt-2">
                            <p class="text-[10px] text-gray-500 font-bold uppercase">åˆ†æ‰¹åœåˆ©å°èˆª</p>
                            <div class="flex justify-between text-xs text-green-400"><span>1. ç¬¬ä¸€ç«™(æ¸›å€‰):</span><span>$${tp1}</span></div>
                            <div class="flex justify-between text-xs text-green-500"><span>2. ç¬¬äºŒç«™(ç²åˆ©):</span><span>$${tp2}</span></div>
                            <div class="flex justify-between text-xs text-green-300 font-bold"><span>3. ç¬¬ä¸‰ç«™(è®“é£›):</span><span>$${tp3}</span></div>
                        </div>
                    </div>

                    <div class="bg-black/50 p-3 rounded-lg text-[10px] space-y-2">
                        <div class="flex justify-between"><span>ğŸš¦ å¡åº¦:</span><b class="${isAboveEMA ? 'text-green-400' : 'text-red-500'}">${isAboveEMA ? 'âœ…å®‰å…¨' : 'âŒå±éšª'}</b></div>
                        <div class="flex justify-between"><span>â›½ æ±½æ²¹:</span><b class="${volConfirm ? 'text-green-400' : 'text-red-500'}">${volConfirm ? 'âœ…å……è¶³' : 'âŒæ²’æ²¹'}</b></div>
                        <p class="text-center pt-2 font-black ${isSafe ? 'text-green-400' : 'text-gray-500'}">${isSafe ? 'â¡ï¸ æ¢ä»¶é”æˆï¼Œé€²å ´ï¼' : 'â¡ï¸ æ¢ä»¶ä¸è¶³ï¼Œè§€æœ›'}</p>
                    </div>
                </div>`;
        }

        // --- æŒ‡æ¨™æ•¸å­¸å‡½æ•¸ ---
        function calcRSI(prices) {
            let g=0, l=0;
            for(let i=prices.length-14; i<prices.length; i++) {
                let d=prices[i]-prices[i-1];
                d>=0 ? g+=d : l-=d;
            }
            return 100 - (100/(1+(g/14)/(l/14)));
        }

        function calcEMA(prices, period) {
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) {
                ema = (prices[i] * k) + (ema * (1 - k));
            }
            return ema;
        }

        function switchTab(tab) {
            ['oversold', 'breakout', 'all'].forEach(t => {
                document.getElementById(`${t}-section`).classList.toggle('hidden', t !== tab);
                document.getElementById(`btn-${t}`).classList.toggle('tab-active', t === tab);
                document.getElementById(`btn-${t}`).classList.toggle('text-gray-500', t !== tab);
            });
            analyze();
        }

        window.onload = analyze;
        setInterval(analyze, 300000);
    </script>
</body>
</html>
