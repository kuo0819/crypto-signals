<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Pro æ™ºèƒ½ç­–ç•¥å°èˆª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #0a0a0a; }
        .tab-active { border-bottom: 4px solid #eab308; color: #eab308; }
        .strategy-card { transition: transform 0.2s; }
        .strategy-card:hover { transform: translateY(-5px); }
    </style>
</head>
<body class="text-slate-100">

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        <header class="mb-8 border-b border-gray-800 pb-6 text-center">
            <h1 class="text-4xl font-black text-yellow-500 mb-2">PRO ç­–ç•¥å°èˆªå„€</h1>
            <p class="text-red-500 font-bold animate-pulse">âš ï¸ è»è¦ï¼šåˆç´„åš´ç¦è¶…é 3-5 å€æ§“æ¡¿ | åš´æ ¼åŸ·è¡Œåœæ âš ï¸</p>
        </header>

        <nav class="flex justify-center space-x-8 mb-10 text-lg font-bold">
            <button onclick="switchTab('oversold')" id="btn-oversold" class="pb-2 tab-active">ğŸŸ¢ è¶…è·ŒæŠ„åº•</button>
            <button onclick="switchTab('breakout')" id="btn-breakout" class="pb-2 text-gray-500">ğŸ”´ å¼·å‹¢çªç ´</button>
            <button onclick="switchTab('all')" id="btn-all" class="pb-2 text-gray-500">ğŸ” å…¨å¸‚å ´ç›£æ§</button>
        </nav>

        <div id="oversold-section">
            <h3 class="text-xl mb-4 text-green-400 font-bold border-l-4 border-green-400 pl-3">ç›®å‰ç¬¦åˆã€Œè¶…è·Œåå½ˆã€çš„å¹£ç¨®</h3>
            <div id="oversold-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>

        <div id="breakout-section" class="hidden">
            <h3 class="text-xl mb-4 text-red-400 font-bold border-l-4 border-red-400 pl-3">ç›®å‰ç¬¦åˆã€Œå¼·å‹¢çªç ´ã€çš„å¹£ç¨®</h3>
            <div id="breakout-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>

        <div id="all-section" class="hidden text-sm">
            <table class="w-full bg-gray-900 rounded-lg overflow-hidden">
                <thead class="bg-gray-800">
                    <tr>
                        <th class="p-4">è²¨å¹£</th>
                        <th class="p-4">åƒ¹æ ¼</th>
                        <th class="p-4">ç†±åº¦(RSI)</th>
                        <th class="p-4">ç‹€æ…‹</th>
                    </tr>
                </thead>
                <tbody id="full-market-tbody" class="divide-y divide-gray-800"></tbody>
            </table>
        </div>
    </div>

    <script>
        const symbols = []; // æœƒç”± API è‡ªå‹•æŠ“å–å‰ 50 å
        let currentTab = 'oversold';

        function switchTab(tab) {
            currentTab = tab;
            ['oversold', 'breakout', 'all'].forEach(t => {
                document.getElementById(`${t}-section`).classList.toggle('hidden', t !== tab);
                document.getElementById(`btn-${t}`).classList.toggle('tab-active', t === tab);
                document.getElementById(`btn-${t}`).classList.toggle('text-gray-500', t !== tab);
            });
            fetchData();
        }

        async function fetchData() {
            const tickerRes = await fetch('https://api.binance.com/api/v3/ticker/24hr');
            const tickerData = await tickerRes.json();
            const top50 = tickerData
                .filter(d => d.symbol.endsWith('USDT'))
                .sort((a, b) => parseFloat(b.quoteVolume) - parseFloat(a.quoteVolume))
                .slice(0, 50);

            const oversoldList = document.getElementById('oversold-list');
            const breakoutList = document.getElementById('breakout-list');
            const fullTbody = document.getElementById('full-market-tbody');
            
            oversoldList.innerHTML = '';
            breakoutList.innerHTML = '';
            fullTbody.innerHTML = '';

            for (let coin of top50) {
                try {
                    const kRes = await fetch(`https://api.binance.com/api/v3/klines?symbol=${coin.symbol}&interval=1h&limit=50`);
                    const kData = await kRes.json();
                    const closes = kData.map(d => parseFloat(d[4]));
                    const price = closes[closes.length - 1];
                    const rsi = calcRSI(closes);
                    const bb = calcBB(closes);

                    // 1. è¶…è·ŒæŠ„åº•é‚è¼¯ (RSIä½ + è§¸ç¢°ä¸‹è»Œ)
                    if (rsi < 30 && price <= bb.lower) {
                        oversoldList.innerHTML += createCard(coin.symbol, price, 'ç¶ è‰²æŠ„åº•', 'green');
                    }

                    // 2. å¼·å‹¢çªç ´é‚è¼¯ (RSIé«˜ + è¡ç ´å¤©èŠ±æ¿)
                    if (rsi > 70 && price >= bb.upper) {
                        breakoutList.innerHTML += createCard(coin.symbol, price, 'å¼·å‹¢è¿½æ¼²', 'red');
                    }

                    fullTbody.innerHTML += `
                        <tr class="text-center">
                            <td class="p-3 font-bold text-yellow-500">${coin.symbol}</td>
                            <td class="p-3">$${price}</td>
                            <td class="p-3">${rsi.toFixed(1)}</td>
                            <td class="p-3">${rsi < 35 ? 'è¶…å†·' : (rsi > 65 ? 'è¶…ç†±' : 'ä¸€èˆ¬')}</td>
                        </tr>`;
                } catch (e) {}
            }
        }

        function createCard(symbol, price, type, color) {
            const stopLoss = (price * 0.97).toFixed(4);
            const takeProfit = (price * 1.09).toFixed(4);
            const borderCol = color === 'green' ? 'border-green-500' : 'border-red-500';
            const bgCol = color === 'green' ? 'bg-green-900/20' : 'bg-red-900/20';

            return `
                <div class="strategy-card ${bgCol} border-2 ${borderCol} p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-2xl font-black">${symbol}</span>
                        <span class="text-xs bg-white text-black px-2 py-1 rounded">3å€æ§“æ¡¿å»ºè­°</span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <p class="flex justify-between">ç¾è²¨é€²å ´: <span class="text-white font-bold">$${price}</span></p>
                        <hr class="border-gray-700">
                        <p class="flex justify-between text-yellow-400 italic">åˆç´„åœåˆ©: <span>$${takeProfit}</span></p>
                        <p class="flex justify-between text-red-500 font-bold underline">åˆç´„åœæ: <span>$${stopLoss}</span></p>
                    </div>
                    <p class="mt-4 text-[10px] text-gray-500">â€» åœæè§¸ç™¼å³é›¢å ´ï¼Œ3å€æ§“æ¡¿é è¨ˆè™§æç´„ 9% æœ¬é‡‘ã€‚</p>
                </div>`;
        }

        function calcRSI(prices) {
            let g=0, l=0;
            for(let i=prices.length-14; i<prices.length; i++) {
                let d=prices[i]-prices[i-1];
                d>=0 ? g+=d : l-=d;
            }
            return 100 - (100/(1+(g/14)/(l/14)));
        }

        function calcBB(prices) {
            const s = prices.slice(-20);
            const m = s.reduce((a,b)=>a+b)/20;
            const d = Math.sqrt(s.map(x=>Math.pow(x-m,2)).reduce((a,b)=>a+b)/20);
            return { upper: m + (d * 2), lower: m - (d * 2) };
        }

        window.onload = fetchData;
        setInterval(fetchData, 60000);
    </script>
</body>
</html>
