<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€ éŸ­èœä¿å‘½ç¬¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #050505; }
        .tab-active { border-bottom: 4px solid #eab308; color: #eab308; font-weight: 900; }
        .calc-input { background: #1a1a1a; border: 1px solid #333; border-radius: 6px; padding: 6px 10px; color: #eab308; font-weight: bold; }
        .card-gradient { background: linear-gradient(145deg, #111111 0%, #050505 100%); }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0.3; } }
        .gold-glow { box-shadow: 0 0 20px rgba(234, 179, 8, 0.3); }
    </style>
</head>
<body class="text-slate-200 p-4 md:p-8">

    <div class="fixed top-2 right-4 z-50">
        <span class="text-xs font-black text-yellow-500 italic">BY PROTECTOR K</span>
    </div>

    <div class="max-w-7xl mx-auto">
        <header class="mb-8 bg-gray-900 border-2 border-yellow-600/50 p-6 rounded-2xl shadow-2xl">
            <h1 class="text-4xl font-black text-yellow-500 italic mb-4">ğŸ€ éŸ­èœä¿å‘½ç¬¦</h1>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-black/40 p-5 rounded-2xl">
                <div>
                    <label class="text-sm font-bold text-gray-400 block mb-2">ğŸ’° ä½ çš„ç¸½é ç®— (USDT)</label>
                    <input type="number" id="total-capital" oninput="saveAndAnalyze()" class="calc-input w-full text-xl" placeholder="è¼¸å…¥é ç®—">
                </div>
                <div>
                    <label class="text-sm font-bold text-gray-400 block mb-2">ğŸ¤– Telegram é€šçŸ¥è¨­å®š</label>
                    <div class="flex gap-2">
                        <input type="password" id="tg-token" oninput="saveAndAnalyze()" class="calc-input text-xs w-full" placeholder="Bot Token">
                        <input type="text" id="tg-id" oninput="saveAndAnalyze()" class="calc-input text-xs w-full" placeholder="Chat ID">
                    </div>
                </div>
            </div>
        </header>

        <section class="mb-8 bg-gray-900/50 p-5 rounded-2xl border border-gray-800">
            <div class="flex justify-between items-center mb-3 text-sm font-bold text-gray-400">
                <h3>ğŸ“Š å¸‚å ´åˆ†æå ±å‘Š</h3>
                <span id="market-status-text" class="px-3 py-1 rounded-full bg-black">æƒæä¸­...</span>
            </div>
            <div class="w-full bg-gray-800 h-4 rounded-full overflow-hidden flex">
                <div id="bull-bar" class="bg-yellow-500 h-full transition-all duration-1000" style="width: 50%"></div>
            </div>
        </section>

        <nav class="flex space-x-12 mb-8 border-b border-gray-800 font-bold">
            <button onclick="switchTab('oversold')" id="btn-oversold" class="pb-4 tab-active">ğŸ’ é»ƒé‡‘æ©Ÿæœƒ (æ’¿ä¾¿å®œ)</button>
            <button onclick="switchTab('breakout')" id="btn-breakout" class="pb-4 text-gray-500">ğŸš€ å¼·å‹¢è¡åˆº</button>
            <button onclick="switchTab('all')" id="btn-all" class="pb-4 text-gray-500">ğŸ” å…¨å¸‚å ´æƒæ</button>
        </nav>

        <div id="oversold-section"><div id="oversold-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div></div>
        <div id="breakout-section" class="hidden"><div id="breakout-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div></div>
        <div id="all-section" class="hidden">
            <div class="bg-gray-900 rounded-2xl overflow-hidden border border-gray-800">
                <table class="w-full text-left text-xs font-bold">
                    <thead class="bg-gray-800 text-gray-400">
                        <tr><th class="p-5">è²¨å¹£</th><th class="p-5">ç›®å‰åƒ¹æ ¼</th><th class="p-5">è·¯æ³</th><th class="p-5">ç‡ƒæ–™</th></tr>
                    </thead>
                    <tbody id="full-tbody" class="divide-y divide-gray-800 font-mono"></tbody>
                </table>
            </div>
        </div>

        <footer class="mt-16 p-8 bg-red-950/20 border border-red-900/30 rounded-3xl text-center">
            <p class="text-red-500 font-black mb-1 italic">âš ï¸ éŸ­èœè­¦èªï¼šåš´æ ¼åŸ·è¡Œåœæï¼Œä¸è¦èˆ‡è¶¨å‹¢ä½œå°ï¼</p>
        </footer>
    </div>

    <script>
        let sentSignals = new Set();
        const BASE_API = "https://api1.binance.com";

        window.onload = () => {
            document.getElementById('total-capital').value = localStorage.getItem('capital') || 1000;
            document.getElementById('tg-token').value = localStorage.getItem('tgToken') || '';
            document.getElementById('tg-id').value = localStorage.getItem('tgId') || '';
            analyze();
        };

        function saveAndAnalyze() {
            localStorage.setItem('capital', document.getElementById('total-capital').value);
            localStorage.setItem('tgToken', document.getElementById('tg-token').value);
            localStorage.setItem('tgId', document.getElementById('tg-id').value);
            analyze();
        }

        async function sendToTelegram(message) {
            const token = document.getElementById('tg-token').value;
            const chatId = document.getElementById('tg-id').value;
            if (!token || !chatId) return;
            const url = `https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}&parse_mode=HTML`;
            try { await fetch(url); } catch (e) { console.error("TG ç™¼é€å¤±æ•—"); }
        }

        async function analyze() {
            const capital = parseFloat(document.getElementById('total-capital').value) || 0;
            const res = await fetch(`${BASE_API}/api/v3/ticker/24hr`);
            const data = await res.json();
            const top50 = data.filter(d => d.symbol.endsWith('USDT')).sort((a, b) => b.quoteVolume - a.quoteVolume).slice(0, 50);

            const bulls = top50.filter(c => parseFloat(c.priceChangePercent) > 0).length;
            document.getElementById('bull-bar').style.width = `${(bulls/50)*100}%`;
            document.getElementById('market-status-text').innerText = bulls > 25 ? "ğŸ“ˆ å¸‚æ³ç©©å®šï¼šé©åˆæ‰¾é»ƒé‡‘æ©Ÿæœƒ" : "ğŸ“‰ å¸‚æ³å±éšªï¼šå¤šçœ‹å°‘å‹•";

            const lists = { oversold: document.getElementById('oversold-list'), breakout: document.getElementById('breakout-list') };
            lists.oversold.innerHTML = ''; lists.breakout.innerHTML = '';
            document.getElementById('full-tbody').innerHTML = '';

            for (let coin of top50) {
                try {
                    const kRes = await fetch(`${BASE_API}/api/v3/klines?symbol=${coin.symbol}&interval=1h&limit=200`);
                    const kData = await kRes.json();
                    const closes = kData.map(d => parseFloat(d[4]));
                    const volumes = kData.map(d => parseFloat(d[5]));
                    const price = closes[closes.length - 1];

                    const rsi = calcRSI(closes);
                    const ema200 = calcEMA(closes, 200);
                    const isAboveEMA = price > ema200;
                    const volConfirm = volumes[volumes.length - 1] > (volumes.slice(-20).reduce((a,b)=>a+b)/20) * 1.5;
                    const isSafe = volConfirm && isAboveEMA;
                    const suggestAmount = (capital * 0.15).toFixed(2);

                    // ç™¼ç¾é»ƒé‡‘æ©Ÿæœƒçš„é€šçŸ¥èˆ‡é¡¯ç¤º
                    if (isSafe && (rsi < 32 || rsi > 68) && !sentSignals.has(coin.symbol)) {
                        const stop = (price * 0.97).toFixed(4);
                        const tp1 = (price * 1.05).toFixed(4);
                        const msg = `<b>ğŸ’ ç™¼ç¾é»ƒé‡‘æ©Ÿæœƒï¼</b>\n\nè²¨å¹£ï¼š<b>${coin.symbol}</b>\né€²å ´ï¼š$${price}\nå»ºè­°æŠ•å…¥ï¼š$${suggestAmount} USDT\n\nğŸ›‘ è³ åˆ°é€™è¦è³£ï¼š$${stop}\nğŸ¯ è³ºéŒ¢ç›®æ¨™ï¼š$${tp1}\n\n<i>BY PROTECTOR K</i>`;
                        sendToTelegram(msg);
                        sentSignals.add(coin.symbol);
                        setTimeout(() => sentSignals.delete(coin.symbol), 3600000);
                    }

                    const cardHtml = createCard(coin.symbol, price, suggestAmount, rsi < 32, volConfirm, isAboveEMA);
                    if (rsi < 32) lists.oversold.innerHTML += cardHtml;
                    if (rsi > 68 && volConfirm) lists.breakout.innerHTML += cardHtml;

                    document.getElementById('full-tbody').innerHTML += `
                        <tr class="hover:bg-gray-800/30">
                            <td class="p-5 font-black text-yellow-500">${coin.symbol}</td>
                            <td class="p-5 text-white">$${price}</td>
                            <td class="p-5 ${isAboveEMA ? 'text-green-500' : 'text-red-500'} font-bold">${isAboveEMA ? 'âœ… å®‰å…¨ä¸Šå¡' : 'âŒ å±éšªä¸‹å¡'}</td>
                            <td class="p-5 ${volConfirm ? 'text-green-500' : 'text-gray-600'}">${volConfirm ? 'ğŸ”¥ ç‡ƒæ–™è¶³' : 'æ²’ç‡ƒæ–™'}</td>
                        </tr>`;
                } catch(e) {}
            }
        }

        function createCard(symbol, price, amount, isOversold, volConfirm, isAboveEMA) {
            const isSafe = volConfirm && isAboveEMA;
            return `
                <div class="card-gradient border-2 ${isSafe ? 'border-yellow-500 gold-glow' : 'border-gray-800'} p-7 rounded-[2rem] relative shadow-xl transition-all">
                    ${isSafe ? '<div class="absolute top-0 right-0 bg-yellow-500 text-black px-4 py-1 text-[10px] font-black blink italic tracking-widest">ğŸ’ é»ƒé‡‘æ©Ÿæœƒ</div>' : ''}
                    <h3 class="text-3xl font-black mb-4 text-white">${symbol}</h3>
                    <div class="bg-yellow-500/10 border border-yellow-500/30 p-4 rounded-2xl mb-6">
                        <p class="text-xs text-yellow-500 font-bold mb-1 italic">ğŸ’¡ æ¨è–¦è²·å…¥é‡‘é¡</p>
                        <p class="text-3xl font-black text-yellow-500 font-mono">$ ${amount}</p>
                    </div>
                    <div class="space-y-3 mb-6 font-bold">
                        <div class="flex justify-between bg-red-950/30 p-3 rounded-xl border border-red-900/30">
                            <span class="text-xs text-red-500">ğŸ›‘ è³ éŒ¢ä¿å‘½é»:</span>
                            <span class="text-sm text-red-500">$${(price*0.97).toFixed(4)}</span>
                        </div>
                        <div class="flex justify-between bg-green-950/30 p-3 rounded-xl border border-green-900/30">
                            <span class="text-xs text-green-500">ğŸ¯ è³ºéŒ¢ä¸‹è»Šé»:</span>
                            <span class="text-sm text-green-400">$${(price*1.05).toFixed(4)}</span>
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px] font-bold text-gray-500 border-t border-gray-800 pt-4">
                        <span>è·¯æ³: ${isAboveEMA?'âœ… ä¸Šå¡å®‰å…¨':'âŒ ä¸‹å¡å±éšª'}</span>
                        <span>ç‡ƒæ–™: ${volConfirm?'ğŸ”¥ å‹•åŠ›å¼·':'â˜ï¸ æ²’å‹•åŠ›'}</span>
                    </div>
                </div>`;
        }

        function calcRSI(prices) {
            let g=0, l=0;
            for(let i=prices.length-14; i<prices.length; i++) {
                let d=prices[i]-prices[i-1];
                d>=0 ? g+=d : l-=d;
            }
            if(l === 0) return 100;
            return 100 - (100/(1+(g/14)/(l/14)));
        }

        function calcEMA(prices, period) {
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) ema = (prices[i] * k) + (ema * (1 - k));
            return ema;
        }

        function switchTab(tab) {
            ['oversold', 'breakout', 'all'].forEach(t => {
                document.getElementById(`${t}-section`).classList.toggle('hidden', t !== tab);
                document.getElementById(`btn-${t}`).className = `pb-4 ${t === tab ? 'tab-active' : 'text-gray-500'}`;
            });
        }
        setInterval(analyze, 300000);
    </script>
</body>
</html>
