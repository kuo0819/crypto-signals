<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ åŠ å¯†è²¨å¹£è‡ªå‹•äº¤æ˜“è­¦å ± - 5åˆ†é˜å³æ™‚Telegramé€šçŸ¥</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff; min-height: 100vh; padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { 
            text-align: center; background: linear-gradient(45deg, #ffd700, #ffed4e); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-size: 2.5em; margin-bottom: 10px;
        }
        .status-bar {
            background: linear-gradient(90deg, #00ff88, #00cc66);
            color: #000; padding: 15px; border-radius: 10px; margin-bottom: 20px;
            font-weight: bold; text-align: center; font-size: 1.1em;
        }
        .disclaimer { 
            background: rgba(255,0,0,0.1); border: 1px solid rgba(255,0,0,0.3); 
            border-radius: 10px; padding: 15px; margin-bottom: 30px; text-align: center;
        }
        .control-panel {
            background: rgba(255,255,255,0.1); border-radius: 15px; padding: 25px;
            margin-bottom: 30px; display: flex; gap: 15px; align-items: center;
            flex-wrap: wrap;
        }
        .form-group { display: flex; flex-direction: column; min-width: 200px; }
        label { font-weight: 600; margin-bottom: 5px; }
        input { padding: 12px; border: none; border-radius: 8px; font-size: 16px; 
                background: rgba(255,255,255,0.9); color: #333; }
        button { 
            background: linear-gradient(45deg, #ff6b6b, #ee5a52); color: white; 
            border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; 
            font-weight: bold; font-size: 16px; transition: all 0.3s ease;
        }
        button:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 10px 25px rgba(255,107,107,0.4); }
        button:disabled { background: #666; cursor: not-allowed; }
        .status { padding: 12px; border-radius: 8px; text-align: center; margin: 15px 0; font-weight: bold; }
        .success { background: rgba(0,255,0,0.2); color: #00ff00; }
        .error { background: rgba(255,0,0,0.2); color: #ff4444; }
        .warning { background: rgba(255,193,7,0.2); color: #ffc107; }
        .countdown { font-size: 2em; color: #ffd700; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; background: rgba(255,255,255,0.05); 
                border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        th { background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); padding: 15px; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        tr.bull td:nth-child(2) { background: rgba(0,255,0,0.2); color: #00ff00; font-weight: bold; }
        tr.bear td:nth-child(2) { background: rgba(255,0,0,0.2); color: #ff4444; font-weight: bold; }
        .price { font-family: 'Courier New', monospace; font-weight: bold; color: #ffd700; }
        @media (max-width: 768px) { .control-panel { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– åŠ å¯†è²¨å¹£è‡ªå‹•äº¤æ˜“è­¦å ±ç³»çµ±</h1>
        <div class="status-bar" id="statusBar">
            â³ è·é›¢ä¸‹æ¬¡ç™¼é€ï¼š<span id="countdown" class="countdown">5:00</span> | å·²é‹è¡Œï¼š<span id="uptime">00:00</span>
        </div>
        
        <div class="disclaimer">
            âš ï¸ æŠ•è³‡æœ‰é¢¨éšªï¼Œæ­¤ç‚ºæŠ€è¡“åˆ†æåƒè€ƒï¼Œéè²¡å‹™å»ºè­°ã€‚è«‹è‡ªè¡Œé©—è­‰ä¸¦åšå¥½é¢¨éšªç®¡ç†ï¼
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <div class="form-group">
                <label>ğŸ¤– Bot Token</label>
                <input type="text" id="botToken" placeholder="1234567890:AAFxxxxxxxxxxxxxxxx">
            </div>
            <div class="form-group">
                <label>ğŸ‘¥ Chat ID</label>
                <input type="text" id="chatId" placeholder="@username æˆ– 123456789">
            </div>
            <div style="display: flex; gap: 10px; align-items: end;">
                <button onclick="testConnection()">ğŸ”— æ¸¬è©¦é€£ç·š</button>
                <button onclick="startAutoSend()" id="startBtn">â–¶ï¸ é–‹å§‹è‡ªå‹•ç™¼é€</button>
                <button onclick="stopAutoSend()" id="stopBtn" disabled>â¹ï¸ åœæ­¢</button>
            </div>
        </div>

        <div id="statusMsg" class="status"></div>

        <!-- äº¤æ˜“å»ºè­°è¡¨æ ¼ -->
        <table>
            <thead>
                <tr>
                    <th>å¹£ç¨®</th>
                    <th>å»ºè­°</th>
                    <th>è²·é€²åƒ¹</th>
                    <th>æ­¢æåƒ¹</th>
                    <th>æ­¢ç›ˆåƒ¹</th>
                    <th>æŒ‡æ¨™ç‹€æ…‹</th>
                    <th>ä¸Šæ¬¡ç™¼é€</th>
                </tr>
            </thead>
            <tbody id="tradeTable">
                <!-- å‹•æ…‹ç”Ÿæˆ -->
            </tbody>
        </table>

        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin-top: 20px;">
            <h3>ğŸ¯ è‡ªå‹•åŒ–ç‰¹è‰²ï¼š</h3>
            <ul style="line-height: 1.8;">
                <li>âœ… <strong>æ¯5åˆ†é˜è‡ªå‹•æª¢æŸ¥æ‰€æœ‰å¹£ç¨®</strong>ï¼Œåªç™¼é€ä¿¡è™Ÿè®Šæ›´çš„å¹£ç¨®</li>
                <li>âœ… <strong>å…¨å¤©å€™é‹è¡Œ</strong>ï¼Œé›»è…¦/æ‰‹æ©Ÿç€è¦½å™¨éƒ½æ”¯æ´</li>
                <li>âœ… <strong>åªç™¼æ–°ä¿¡è™Ÿ</strong>ï¼Œé¿å…é‡è¤‡é€šçŸ¥</li>
                <li>âœ… <strong>å¯¦æ™‚å€’æ•¸è¨ˆæ™‚</strong>ï¼Œæ¸…æ¥šçŸ¥é“ä¸‹æ¬¡ç™¼é€æ™‚é–“</li>
            </ul>
        </div>
    </div>

    <script>
        // äº¤æ˜“æ•¸æ“š
        const trades = [
            {symbol: 'BTC', direction: 'ğŸŸ¢åšå¤š', entry: '$90,600', sl: '$88,000', tp: '$96,000', lastSent: null},
            {symbol: 'ETH', direction: 'ğŸŸ¢åšå¤š', entry: '$3,800', sl: '$3,650', tp: '$4,100', lastSent: null},
            {symbol: 'XRP', direction: 'ğŸŸ¢åšå¤š', entry: '$1.20', sl: '$1.10', tp: '$1.40', lastSent: null},
            {symbol: 'BNB', direction: 'ğŸŸ¢åšå¤š', entry: '$650', sl: '$620', tp: '$710', lastSent: null},
            {symbol: 'SOL', direction: 'ğŸŸ¢åšå¤š', entry: '$220', sl: '$210', tp: '$250', lastSent: null},
            {symbol: 'LTC', direction: 'ğŸ”´åšç©º', entry: '$95', sl: '$100', tp: '$85', lastSent: null}
        ];

        let autoInterval = null;
        let countdownInterval = null;
        let secondsLeft = 300; // 5åˆ†é˜
        let isRunning = false;
        let prevSignals = new Map();

        // åˆå§‹åŒ–è¡¨æ ¼
        function initTable() {
            const tbody = document.getElementById('tradeTable');
            tbody.innerHTML = trades.map(trade => `
                <tr class="${trade.direction.includes('åšå¤š') ? 'bull' : 'bear'}" data-symbol="${trade.symbol}">
                    <td><strong>${trade.symbol}</strong></td>
                    <td>${trade.direction}</td>
                    <td class="price">${trade.entry}</td>
                    <td class="price">${trade.sl}</td>
                    <td class="price">${trade.tp}</td>
                    <td>ğŸŸ¢ MACD/RSI/KDJ</td>
                    <td id="lastSent-${trade.symbol}">-</td>
                </tr>
            `).join('');
        }

        // ç²å–è¨­å®š
        function getSettings() {
            return {
                botToken: document.getElementById('botToken').value.trim(),
                chatId: document.getElementById('chatId').value.trim()
            };
        }

        // é¡¯ç¤ºç‹€æ…‹
        function showStatus(msg, type = 'info') {
            const el = document.getElementById('statusMsg');
            el.textContent = msg;
            el.className = `status ${type}`;
        }

        // æ¸¬è©¦é€£ç·š
        async function testConnection() {
            const { botToken } = getSettings();
            if (!botToken) return showStatus('âŒ è«‹è¼¸å…¥ Bot Token', 'error');

            try {
                const res = await fetch(`https://api.telegram.org/bot${botToken}/getMe`);
                const data = await res.json();
                if (data.ok) {
                    showStatus(`âœ… Boté€£ç·šæˆåŠŸï¼š${data.result.first_name}`, 'success');
                } else {
                    showStatus('âŒ Bot Token éŒ¯èª¤', 'error');
                }
            } catch {
                showStatus('âŒ é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯', 'error');
            }
        }

        // ç™¼é€Telegramè¨Šæ¯
        async function sendTelegram(trade) {
            const { botToken, chatId } = getSettings();
            if (!botToken || !chatId) return false;

            const message = `ğŸš€ å¹£ç¨®å»ºè­°ï¼š${trade.symbol} ${trade.direction}\n` +
                          `è²·é€²åƒ¹ï¼š${trade.entry}\n` +
                          `æ­¢æåƒ¹ï¼š${trade.sl} (é¢¨éšªæ§åˆ¶)\n` +
                          `æ­¢ç›ˆåƒ¹ï¼š${trade.tp} (ç›®æ¨™åˆ©æ½¤)\n` +
                          `æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}\n` +
                          `#CryptoAlert #${trade.symbol}`;

            try {
                const res = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: chatId, text: message, parse_mode: 'HTML' })
                });
                const data = await res.json();
                return data.ok;
            } catch {
                return false;
            }
        }

        // æª¢æŸ¥ä¸¦ç™¼é€è®Šæ›´ä¿¡è™Ÿ
        async function checkAndSend() {
            const sentToday = new Map();
            for (const trade of trades) {
                const signalKey = `${trade.symbol}-${trade.direction}`;
                
                // æª¢æŸ¥ä¿¡è™Ÿæ˜¯å¦æ”¹è®Šï¼ˆæ¨¡æ“¬å¸‚å ´è®ŠåŒ–ï¼‰
                const currentSignal = signalKey; 
                const prevSignal = prevSignals.get(trade.symbol);
                
                if (!prevSignal || currentSignal !== prevSignal) {
                    if (await sendTelegram(trade)) {
                        document.getElementById(`lastSent-${trade.symbol}`).textContent = 
                            new Date().toLocaleTimeString('zh-TW');
                        showStatus(`âœ… å·²ç™¼é€ ${trade.symbol} äº¤æ˜“è¨Šæ¯`, 'success');
                    } else {
                        showStatus(`âŒ ${trade.symbol} ç™¼é€å¤±æ•—`, 'error');
                    }
                    prevSignals.set(trade.symbol, currentSignal);
                }
                sentToday.set(trade.symbol, true);
            }
        }

        // å€’æ•¸è¨ˆæ™‚
        function startCountdown() {
            countdownInterval = setInterval(() => {
                secondsLeft--;
                const min = Math.floor(secondsLeft / 60);
                const sec = secondsLeft % 60;
                document.getElementById('countdown').textContent = `${min}:${sec.toString().padStart(2, '0')}`;
                
                if (secondsLeft <= 0) {
                    secondsLeft = 300;
                    checkAndSend();
                }
            }, 1000);
        }

        // æ›´æ–°é‹è¡Œæ™‚é–“
        function updateUptime() {
            const startTime = new Date().getTime();
            setInterval(() => {
                const now = new Date();
                const elapsed = new Date(now - startTime);
                document.getElementById('uptime').textContent = 
                    `${elapsed.getUTCMinutes().toString().padStart(2, '0')}:${elapsed.getUTCSeconds().toString().padStart(2, '0')}`;
            }, 1000);
        }

        // é–‹å§‹è‡ªå‹•ç™¼é€
        async function startAutoSend() {
            const { botToken, chatId } = getSettings();
            if (!botToken || !chatId) {
                showStatus('âŒ è«‹å…ˆå¡«å…¥ Bot Token å’Œ Chat ID', 'error');
                return;
            }

            isRunning = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            showStatus('â–¶ï¸ è‡ªå‹•ç™¼é€ç³»çµ±å·²å•Ÿå‹•ï¼Œæ¯5åˆ†é˜æª¢æŸ¥ä¸€æ¬¡', 'success');
            
            updateUptime();
            await checkAndSend(); // ç«‹å³ç™¼é€ä¸€æ¬¡
            startCountdown();
        }

        // åœæ­¢è‡ªå‹•ç™¼é€
        function stopAutoSend() {
            isRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            showStatus('â¹ï¸ è‡ªå‹•ç™¼é€å·²åœæ­¢', 'warning');
            
            if (countdownInterval) clearInterval(countdownInterval);
            if (autoInterval) clearInterval(autoInterval);
            secondsLeft = 300;
            document.getElementById('countdown').textContent = '5:00';
        }

        // åˆå§‹åŒ–
        initTable();
        showStatus('æº–å‚™å°±ç·’ï¼Œè«‹è¨­å®š Bot Token èˆ‡ Chat ID å¾Œé»æ“Šã€Œé–‹å§‹è‡ªå‹•ç™¼é€ã€', 'warning');
    </script>
</body>
</html>
