<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€ éŸ­èœä¿å‘½ç¬¦ - Crypto è‡ªå‹•å°èˆªå„€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #050505; }
        .tab-active { border-bottom: 4px solid #eab308; color: #eab308; font-weight: 900; }
        .calc-input { background: #1a1a1a; border: 1px solid #333; border-radius: 6px; padding: 6px 10px; color: #eab308; font-weight: bold; transition: all 0.3s; }
        .calc-input:focus { border-color: #eab308; outline: none; box-shadow: 0 0 10px rgba(234, 179, 8, 0.2); }
        .blink { animation: blinker 1.5s linear infinite; }
        @keyframes blinker { 50% { opacity: 0.3; } }
        .card-gradient { background: linear-gradient(145deg, #111111 0%, #050505 100%); }
        .neon-text { text-shadow: 0 0 10px rgba(234, 179, 8, 0.8), 0 0 20px rgba(234, 179, 8, 0.4); }
        /* æ»¾å‹•æ¢ç¾åŒ– */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="text-slate-200 p-4 md:p-8">

    <div class="fixed top-2 right-4 z-50 pointer-events-none select-none">
        <div class="flex flex-col items-end">
            <span class="text-[8px] font-black text-gray-700 tracking-[0.2em] uppercase">System Architect</span>
            <span class="text-xs font-black text-yellow-500 italic neon-text">
                BY PROTECTOR K
            </span>
        </div>
    </div>

    <div class="max-w-7xl mx-auto">
        <header class="mb-8 bg-gray-900 border-2 border-yellow-600/50 p-6 rounded-2xl shadow-2xl">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                <div>
                    <h1 class="text-4xl font-black text-yellow-500 tracking-tighter italic flex items-center gap-2">
                        <span>ğŸ€</span> éŸ­èœä¿å‘½ç¬¦
                    </h1>
                    <p class="text-xs text-gray-400 mt-2 font-bold tracking-widest uppercase">Leek Protector v2.5 | å®ˆè­·æœ¬é‡‘æ˜¯å”¯ä¸€çœŸç†</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full lg:w-auto bg-black/40 p-5 rounded-2xl border border-gray-800">
                    <div class="space-y-2">
                        <label class="text-xs font-black text-gray-500 block">ğŸ’° æˆ‘çš„ç¸½æœ¬é‡‘ (USDT)</label>
                        <input type="number" id="total-capital" placeholder="ä¾‹å¦‚: 1000" oninput="saveAndAnalyze()" class="calc-input w-full text-xl">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-black text-gray-500 block">ğŸ¤– TG é€šçŸ¥è¨­å®š (éš±ç§åŠ å¯†å„²å­˜)</label>
                        <div class="flex gap-2">
                            <input type="password" id="tg-token" placeholder="Bot Token" oninput="saveAndAnalyze()" class="calc-input text-xs w-full">
                            <input type="text" id="tg-id" placeholder="Chat ID" oninput="saveAndAnalyze()" class="calc-input text-xs w-full">
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section class="mb-8 bg-gray-900/50 p-5 rounded-2xl border border-gray-800">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-sm font-black text-gray-400">ğŸŒ å…¨çƒè·¯æ³çµ±è¨ˆ (å¸‚å ´å»£åº¦)</h3>
                <span id="market-status-text" class="text-xs font-bold px-3 py-1 rounded-full bg-black">æƒæä¸­...</span>
            </div>
            <div class="w-full bg-gray-800 h-4 rounded-full overflow-hidden flex shadow-inner">
                <div id="bull-bar" class="bg-gradient-to-r from-green-600 to-green-400 h-full transition-all duration-1000" style="width: 50%"></div>
            </div>
            <div class="flex justify-between text-[10px] mt-2 text-gray-500 font-bold uppercase tracking-wider">
                <span>ğŸŸ¢ å¤šé ­æ°£æ°›: <span id="bull-count" class="text-green-500">0</span></span>
                <span>ğŸ”´ ç©ºé ­æ°£æ°›: <span id="bear-count" class="text-red-500">0</span></span>
            </div>
        </section>

        <nav class="flex space-x-12 mb-8 border-b border-gray-800 font-black text-sm text-gray-500">
            <button onclick="switchTab('oversold')" id="btn-oversold" class="pb-4 tab-active transition-all">ğŸ’ æ’¿ä¾¿å®œå€ (è¶…è·Œ)</button>
            <button onclick="switchTab('breakout')" id="btn-breakout" class="pb-4 hover:text-gray-300">ğŸš€ è¡åˆºå€ (å¼·å‹¢)</button>
            <button onclick="switchTab('all')" id="btn-all" class="pb-4 hover:text-gray-300">ğŸ” å…¨çƒæƒæå„€</button>
        </nav>

        <div id="oversold-section"><div id="oversold-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div></div>
        <div id="breakout-section" class="hidden"><div id="breakout-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div></div>
        <div id="all-section" class="hidden">
            <div class="bg-gray-900 rounded-3xl overflow-hidden border border-gray-800 shadow-2xl">
                <table class="w-full text-left text-xs font-bold">
                    <thead class="bg-gray-800/50 text-gray-400 uppercase">
                        <tr><th class="p-5">è²¨å¹£</th><th class="p-5">ç•¶å‰åƒ¹æ ¼</th><th class="p-5">EMA200 è¶¨å‹¢</th><th class="p-5">å¤§æˆ¶å‹•èƒ½</th></tr>
                    </thead>
                    <tbody id="full-tbody" class="divide-y divide-gray-800 font-mono text-gray-300"></tbody>
                </table>
            </div>
        </div>

        <footer class="mt-16 p-8 bg-red-950/10 border border-red-900/20 rounded-3xl text-center">
            <p class="text-red-500 font-black mb-2 italic">âš ï¸ éŸ­èœè­¦èªï¼šç³»çµ±åƒ…ä¾›åƒè€ƒï¼Œè«‹åš´æ ¼åŸ·è¡Œåœæï¼Œä¸è¦èˆ‡è¶¨å‹¢ä½œå°ã€‚</p>
            <p class="text-gray-600 text-[10px] tracking-widest font-bold">PROTECTOR K ENGINEERING | GLOBAL MARKET SCANNER v2.5</p>
        </footer>
    </div>

    <script>
        let sentSignals = new Set();
        // ä½¿ç”¨ api1 å‚™ç”¨ç¯€é»ï¼Œç©©å®šæ€§æ›´é«˜
        const BASE_API = "https://api1.binance.com";

        window.onload = () => {
            document.getElementById('total-capital').value = localStorage.getItem('capital') || 1000;
            document.getElementById('tg-token').value = localStorage.getItem('tgToken') || '';
            document.getElementById('tg-id').value = localStorage.getItem('tgId') || '';
            analyze();
        };

        function saveAndAnalyze() {
            localStorage.setItem('capital', document.getElementById('total-capital').value);
            localStorage.setItem('tgToken', document.getElementById('tg-token').value);
            localStorage.setItem('tgId', document.getElementById('tg-id').value);
            analyze();
        }

        async function sendToTelegram(message) {
            const token = document.getElementById('tg-token').value;
            const chatId = document.getElementById('tg-id').value;
            if (!token || !chatId) return;
            const url = `https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}&parse_mode=HTML`;
            try { await fetch(url); } catch (e) { console.error("TG ç™¼é€å¤±æ•—"); }
        }

        async function analyze() {
            const capital = parseFloat(document.getElementById('total-capital').value) || 0;
            const res = await fetch(`${BASE_API}/api/v3/ticker/24hr`);
            const data = await res.json();
            const top50 = data.filter(d => d.symbol.endsWith('USDT')).sort((a, b) => b.quoteVolume - a.quoteVolume).slice(0, 50);

            const bulls = top50.filter(c => parseFloat(c.priceChangePercent) > 0).length;
            document.getElementById('bull-bar').style.width = `${(bulls/50)*100}%`;
            document.getElementById('bull-count').innerText = bulls;
            document.getElementById('bear-count').innerText = 50 - bulls;
            document.getElementById('market-status-text').innerText = bulls > 25 ? "ğŸ“ˆ å¤šé ­å¸‚å ´" : "ğŸ“‰ ç©ºé ­å¸‚å ´";

            const lists = { oversold: document.getElementById('oversold-list'), breakout: document.getElementById('breakout-list') };
            lists.oversold.innerHTML = ''; lists.breakout.innerHTML = '';
            document.getElementById('full-tbody').innerHTML = '';

            for (let coin of top50) {
                try {
                    const kRes = await fetch(`${BASE_API}/api/v3/klines?symbol=${coin.symbol}&interval=1h&limit=200`);
                    const kData = await kRes.json();
                    const closes = kData.map(d => parseFloat(d[4]));
                    const volumes = kData.map(d => parseFloat(d[5]));
                    const price = closes[closes.length - 1];

                    const rsi = calcRSI(closes);
                    const ema200 = calcEMA(closes, 200);
                    const isAboveEMA = price > ema200;
                    const volConfirm = volumes[volumes.length - 1] > (volumes.slice(-20).reduce((a,b)=>a+b)/20) * 1.5;
                    const isSafe = volConfirm && isAboveEMA;
                    const suggestAmount = (capital * 0.15).toFixed(2);

                    // æ ¸å¿ƒåˆ¤æ–·ï¼šé€²å ´è¨Šè™Ÿç™¼é€
                    if (isSafe && (rsi < 32 || rsi > 68) && !sentSignals.has(coin.symbol)) {
                        const stop = (price * 0.97).toFixed(4);
                        const tp1 = (price * 1.05).toFixed(4);
                        const msg = `<b>ğŸ€ éŸ­èœä¿å‘½ç¬¦è¨Šè™Ÿ</b>\n\nå¹£ç¨®ï¼š<b>${coin.symbol}</b>\né€²å ´åƒ¹ï¼š$${price}\nå»ºè­°æŠ•å…¥ï¼š$${suggestAmount} USDT\n\nğŸ›‘ æ­¢æï¼š$${stop}\nğŸ¯ ç›®æ¨™ï¼š$${tp1}\n\n<i>BY PROTECTOR K</i>`;
                        sendToTelegram(msg);
                        sentSignals.add(coin.symbol);
                        setTimeout(() => sentSignals.delete(coin.symbol), 3600000);
                    }

                    const cardHtml = createCard(coin.symbol, price, suggestAmount, rsi < 32, volConfirm, isAboveEMA);
                    if (rsi < 32) lists.oversold.innerHTML += cardHtml;
                    if (rsi > 68 && volConfirm) lists.breakout.innerHTML += cardHtml;

                    document.getElementById('full-tbody').innerHTML += `
                        <tr class="hover:bg-gray-800/30 transition-colors">
                            <td class="p-5 font-black text-yellow-500">${coin.symbol}</td>
                            <td class="p-5 font-bold tracking-tighter text-white">$${price}</td>
                            <td class="p-5 ${isAboveEMA ? 'text-green-500' : 'text-red-500'} font-black">${isAboveEMA ? 'ğŸŸ¢ å¤šé ­ä¸Šå¡' : 'ğŸ”´ ç©ºé ­ä¸‹å¡'}</td>
                            <td class="p-5 ${volConfirm ? 'text-green-500' : 'text-gray-700'}">${volConfirm ? 'ğŸ”¥ çˆ†é‡ç¢ºèª' : 'ä½è¿·'}</td>
                        </tr>`;
                } catch(e) {}
            }
        }

        function createCard(symbol, price, amount, isOversold, volConfirm, isAboveEMA) {
            const isSafe = volConfirm && isAboveEMA;
            return `
                <div class="card-gradient border-2 ${isSafe ? 'border-green-500 shadow-2xl shadow-green-900/20' : 'border-gray-800'} p-7 rounded-[2rem] relative overflow-hidden transition-all hover:scale-[1.02]">
                    ${isSafe ? '<div class="absolute top-0 right-0 bg-green-500 text-black px-5 py-1 text-[10px] font-black blink italic tracking-tighter uppercase">Protector Recommended</div>' : ''}
                    <h3 class="text-3xl font-black mb-5 tracking-tighter text-white">${symbol}</h3>
                    <div class="bg-yellow-500/10 border border-yellow-500/30 p-4 rounded-2xl mb-6 text-center">
                        <p class="text-[10px] text-yellow-500 font-black mb-1">æ¨è–¦æŠ•å…¥é‡‘é¡</p>
                        <p class="text-3xl font-black text-yellow-500">$ ${amount}</p>
                    </div>
                    <div class="space-y-4 mb-8">
                        <div class="flex justify-between items-center bg-red-950/30 p-3 rounded-xl">
                            <span class="text-xs text-red-500 font-black tracking-widest uppercase">ğŸ›‘ åš´æ ¼åœæ:</span>
                            <span class="text-sm font-mono text-red-500 font-black">$${(price*0.97).toFixed(4)}</span>
                        </div>
                        <div class="flex justify-between items-center bg-green-950/30 p-3 rounded-xl">
                            <span class="text-xs text-green-500 font-black tracking-widest uppercase">ğŸ¯ æ­¢ç›ˆç›®æ¨™:</span>
                            <span class="text-sm font-mono text-green-400 font-black">$${(price*1.05).toFixed(4)}</span>
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px] font-black opacity-40 uppercase tracking-tighter">
                        <span>EMA200: ${isAboveEMA?'SAFE':'DANGER'}</span>
                        <span>VOL: ${volConfirm?'OK':'WAIT'}</span>
                    </div>
                </div>`;
        }

        function calcRSI(prices) {
            let g=0, l=0;
            for(let i=prices.length-14; i<prices.length; i++) {
                let d=prices[i]-prices[i-1];
                d>=0 ? g+=d : l-=d;
            }
            if(l === 0) return 100;
            return 100 - (100/(1+(g/14)/(l/14)));
        }

        function calcEMA(prices, period) {
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) ema = (prices[i] * k) + (ema * (1 - k));
            return ema;
        }

        function switchTab(tab) {
            ['oversold', 'breakout', 'all'].forEach(t => {
                document.getElementById(`${t}-section`).classList.toggle('hidden', t !== tab);
                document.getElementById(`btn-${t}`).className = `pb-4 ${t === tab ? 'tab-active' : 'text-gray-500 hover:text-gray-300'}`;
            });
        }

        // æ¯ 5 åˆ†é˜æƒæä¸€æ¬¡
        setInterval(analyze, 300000);
    </script>
</body>
</html>
