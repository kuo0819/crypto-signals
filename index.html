<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Pro çµ‚æ¥µå…¨èƒ½å°èˆªå„€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #050505; }
        .tab-active { border-bottom: 4px solid #eab308; color: #eab308; }
        .calc-input { background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 4px 8px; width: 120px; color: #eab308; font-weight: bold; }
        .blink { animation: blinker 2s linear infinite; }
        @keyframes blinker { 50% { opacity: 0.5; } }
    </style>
</head>
<body class="text-slate-200 p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="mb-8 bg-gray-900 border-2 border-yellow-600/50 p-6 rounded-2xl shadow-2xl flex flex-col md:flex-row justify-between items-center gap-6">
            <div>
                <h1 class="text-3xl font-black text-yellow-500 tracking-tighter italic">PRO NAVIGATOR</h1>
                <p class="text-xs text-gray-400 mt-1">å…¨èƒ½ç‰ˆï¼šéæ¿¾å‡è¨Šè™Ÿ + è‡ªå‹•æ§å€‰</p>
            </div>
            <div class="flex items-center gap-4 bg-black/50 p-4 rounded-xl border border-gray-800">
                <label class="text-sm font-bold">ğŸ’° ç¸½æœ¬é‡‘ (USDT):</label>
                <input type="number" id="total-capital" value="1000" oninput="analyze()" class="calc-input text-xl">
            </div>
        </header>

        <nav class="flex space-x-10 mb-8 border-b border-gray-800 font-bold text-sm">
            <button onclick="switchTab('oversold')" id="btn-oversold" class="pb-3 tab-active">â„ï¸ å®‰å…¨æŠ„åº• (æ¥µå†·åå½ˆ)</button>
            <button onclick="switchTab('breakout')" id="btn-breakout" class="pb-3 text-gray-500">ğŸ”¥ çœŸå¯¦çªç ´ (å¼·å‹¢è¿½æ¼²)</button>
            <button onclick="switchTab('all')" id="btn-all" class="pb-3 text-gray-500">ğŸ” å¸‚å ´æƒ…ç·’å…¨æƒæ</button>
        </nav>

        <div id="oversold-section">
            <div id="oversold-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>

        <div id="breakout-section" class="hidden">
            <div id="breakout-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>

        <div id="all-section" class="hidden">
            <div class="bg-gray-900 rounded-xl overflow-hidden border border-gray-800 text-xs">
                <table class="w-full text-left">
                    <thead class="bg-gray-800 text-gray-400">
                        <tr>
                            <th class="p-4">è³‡ç”¢åç¨±</th>
                            <th class="p-4">ç›®å‰åƒ¹æ ¼</th>
                            <th class="p-4 text-center">å¸‚å ´æƒ…ç·’</th>
                            <th class="p-4">è¶¨å‹¢ç‹€æ…‹</th>
                            <th class="p-4 text-right">å»ºè­°</th>
                        </tr>
                    </thead>
                    <tbody id="full-tbody" class="divide-y divide-gray-800 font-mono"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        async function analyze() {
            const capital = parseFloat(document.getElementById('total-capital').value) || 0;
            const res = await fetch('https://api.binance.com/api/v3/ticker/24hr');
            const data = await res.json();
            const top50 = data.filter(d => d.symbol.endsWith('USDT')).sort((a, b) => b.quoteVolume - a.quoteVolume).slice(0, 50);

            const oversoldList = document.getElementById('oversold-list');
            const breakoutList = document.getElementById('breakout-list');
            const fullTbody = document.getElementById('full-tbody');

            oversoldList.innerHTML = ''; breakoutList.innerHTML = ''; fullTbody.innerHTML = '';

            for (let coin of top50) {
                try {
                    const kRes = await fetch(`https://api.binance.com/api/v3/klines?symbol=${coin.symbol}&interval=1h&limit=200`);
                    const kData = await kRes.json();
                    const closes = kData.map(d => parseFloat(d[4]));
                    const volumes = kData.map(d => parseFloat(d[5]));
                    const price = closes[closes.length - 1];

                    // æŒ‡æ¨™è¨ˆç®—
                    const rsi = calcRSI(closes);
                    const ema200 = calcEMA(closes, 200);
                    const avgVol = volumes.slice(-20).reduce((a,b)=>a+b)/20;
                    const currentVol = volumes[volumes.length - 1];
                    
                    const volConfirm = currentVol > avgVol * 1.5; // é‡èƒ½æ”¾å¤§
                    const isAboveEMA = price > ema200; // é•·æœŸå¤šé ­è¶¨å‹¢
                    
                    // è³‡é‡‘å»ºè­°ï¼šå–®ç­†æŠ•å…¥æœ¬é‡‘ 15% (2%é¢¨éšªç®¡æ§)
                    const suggestAmount = (capital * 0.15).toFixed(2);

                    // 1. å®‰å…¨æŠ„åº•ï¼šè¶…å†· + æœ‰é‡
                    if (rsi < 32) {
                        oversoldList.innerHTML += createCard(coin.symbol, price, suggestAmount, true, volConfirm, isAboveEMA);
                    }
                    // 2. çœŸå¯¦çªç ´ï¼šè¶…ç†± + æœ‰é‡
                    if (rsi > 68 && volConfirm) {
                        breakoutList.innerHTML += createCard(coin.symbol, price, suggestAmount, false, volConfirm, isAboveEMA);
                    }

                    // 3. å…¨æƒæè¡¨
                    let mood = rsi < 32 ? "â„ï¸ æ¥µå†·" : (rsi > 68 ? "ğŸ”¥ æ¥µç†±" : "â˜ï¸ ä¸€èˆ¬");
                    let moodColor = rsi < 32 ? "text-green-400" : (rsi > 68 ? "text-red-400" : "text-gray-500");

                    fullTbody.innerHTML += `
                        <tr class="hover:bg-gray-800">
                            <td class="p-4 font-bold text-yellow-500">${coin.symbol}</td>
                            <td class="p-4 text-white font-bold">$${price}</td>
                            <td class="p-4 text-center ${moodColor}">${mood} (${rsi.toFixed(0)})</td>
                            <td class="p-4 ${isAboveEMA ? 'text-green-500' : 'text-red-500'} font-bold">
                                ${isAboveEMA ? 'ğŸ“ˆ å¤šé ­è¶¨å‹¢' : 'ğŸ“‰ ç©ºé ­è¶¨å‹¢'}
                            </td>
                            <td class="p-4 text-right ${volConfirm ? 'text-yellow-500' : 'text-gray-600'}">
                                ${volConfirm ? 'ğŸ”¥ ä¸»åŠ›é€²å ´' : 'æˆäº¤ä¸€èˆ¬'}
                            </td>
                        </tr>`;
                } catch(e) {}
            }
        }

        function createCard(symbol, price, amount, isOversold, volConfirm, isAboveEMA) {
            const isSafe = volConfirm && isAboveEMA;
            const stopLoss = (price * 0.97).toFixed(4);
            const takeProfit = (price * 1.08).toFixed(4);

            return `
                <div class="bg-gray-900 border-2 ${isSafe ? 'border-green-500' : 'border-yellow-600'} p-6 rounded-2xl shadow-xl relative">
                    ${isSafe ? '<div class="absolute -top-2 -right-2 bg-green-500 text-black px-3 py-1 rounded-full text-[10px] font-black blink">é«˜å‹ç‡æ¨è–¦</div>' : ''}
                    <h3 class="text-2xl font-black mb-1">${symbol}</h3>
                    <div class="text-[10px] text-gray-500 mb-4">${isOversold ? 'ğŸ’¡ æŠ„åº•æ¨¡å¼' : 'âš¡ çªç ´æ¨¡å¼'}</div>
                    
                    <div class="bg-yellow-500/10 border border-yellow-500/50 p-4 rounded-xl mb-4 text-center">
                        <p class="text-[10px] text-yellow-500 font-bold uppercase mb-1">å»ºè­°å–®ç­†æŠ•å…¥é‡</p>
                        <p class="text-3xl font-black text-white">$ ${amount} <span class="text-sm font-normal">USDT</span></p>
                    </div>

                    <div class="space-y-3 text-sm mb-6">
                        <div class="flex justify-between"><span>é€²å ´åƒ¹:</span><span class="text-white font-mono">$${price}</span></div>
                        <div class="flex justify-between text-yellow-400"><span>ç›®æ¨™ç²åˆ©:</span><span class="font-mono">$${takeProfit}</span></div>
                        <div class="flex justify-between text-red-500 font-bold underline"><span>å¼·åˆ¶åœæ:</span><span class="font-mono">$${stopLoss}</span></div>
                    </div>

                    <div class="bg-black/50 p-3 rounded-lg text-[10px] text-gray-400 space-y-1">
                        <p>å¤§æˆ¶å‹•å‘: ${volConfirm ? 'âœ… æˆäº¤é‡æ”¾å¤§' : 'âŒ é‡èƒ½å¹³æ·¡'}</p>
                        <p>é•·æœŸè¶¨å‹¢: ${isAboveEMA ? 'âœ… EMA200 ä»¥ä¸Š' : 'âŒ EMA200 ä»¥ä¸‹'}</p>
                    </div>
                </div>`;
        }

        function calcRSI(prices) {
            let g=0, l=0;
            for(let i=prices.length-14; i<prices.length; i++) {
                let d=prices[i]-prices[i-1];
                d>=0 ? g+=d : l-=d;
            }
            return 100 - (100/(1+(g/14)/(l/14)));
        }

        function calcEMA(prices, period) {
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) {
                ema = (prices[i] * k) + (ema * (1 - k));
            }
            return ema;
        }

        function switchTab(tab) {
            ['oversold', 'breakout', 'all'].forEach(t => {
                document.getElementById(`${t}-section`).classList.toggle('hidden', t !== tab);
                document.getElementById(`btn-${t}`).classList.toggle('tab-active', t === tab);
                document.getElementById(`btn-${t}`).classList.toggle('text-gray-500', t !== tab);
            });
            analyze();
        }

        window.onload = analyze;
        setInterval(analyze, 300000); // 5åˆ†é˜è‡ªå‹•æ›´æ–°
    </script>
</body>
</html>
