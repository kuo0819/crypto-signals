<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Pro å°èˆªå„€ - Telegram å¯¦æ™‚é€šçŸ¥ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #050505; }
        .tab-active { border-bottom: 4px solid #eab308; color: #eab308; }
        .calc-input { background: #1a1a1a; border: 1px solid #333; border-radius: 4px; padding: 4px 8px; width: 120px; color: #eab308; font-weight: bold; }
        .blink { animation: blinker 1.5s linear infinite; }
        @keyframes blinker { 50% { opacity: 0.3; } }
    </style>
</head>
<body class="text-slate-200 p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <section class="mb-6 bg-gray-900/50 p-4 rounded-xl border border-gray-800">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-xs font-bold text-gray-400">ğŸŒ å…¨å¸‚å ´è·¯æ³çµ±è¨ˆ (å‰50å¤§å¹£ç¨®)</h3>
                <div class="flex items-center gap-2">
                    <span id="tg-status" class="text-[10px] bg-blue-900/50 text-blue-400 px-2 py-0.5 rounded border border-blue-800">TG å®ˆè­·ä¸­</span>
                    <span id="market-status-text" class="text-xs font-bold">æƒæä¸­...</span>
                </div>
            </div>
            <div class="w-full bg-red-900/30 h-4 rounded-full overflow-hidden flex">
                <div id="bull-bar" class="bg-green-500 h-full transition-all duration-500" style="width: 50%"></div>
                <div id="bear-bar" class="bg-red-500 h-full transition-all duration-500" style="width: 50%"></div>
            </div>
        </section>

        <header class="mb-8 bg-gray-900 border-2 border-yellow-600/50 p-6 rounded-2xl shadow-2xl flex flex-col md:flex-row justify-between items-center gap-6">
            <div>
                <h1 class="text-3xl font-black text-yellow-500 tracking-tighter italic">æ–°æ‰‹äº¤æ˜“å°èˆªå„€</h1>
                <p class="text-xs text-gray-400 mt-1">åŠŸèƒ½ï¼šè·¯æ³æƒæ | åˆ†æ‰¹åœåˆ© | Telegram å¯¦æ™‚é€šçŸ¥</p>
            </div>
            <div class="flex items-center gap-4 bg-black/50 p-4 rounded-xl border border-gray-800">
                <label class="text-sm font-bold">ğŸ’° ç¸½æœ¬é‡‘ (USDT):</label>
                <input type="number" id="total-capital" value="30" oninput="analyze()" class="calc-input text-xl">
            </div>
        </header>

        <nav class="flex space-x-10 mb-8 border-b border-gray-800 font-bold text-sm">
            <button onclick="switchTab('oversold')" id="btn-oversold" class="pb-3 tab-active">ğŸ’ æ’¿ä¾¿å®œå€</button>
            <button onclick="switchTab('breakout')" id="btn-breakout" class="pb-3 text-gray-500">ğŸš€ è¡åˆºå€</button>
            <button onclick="switchTab('all')" id="btn-all" class="pb-3 text-gray-500">ğŸ” å¸‚å ´å…¨æƒæ</button>
        </nav>

        <div id="oversold-section"><div id="oversold-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div></div>
        <div id="breakout-section" class="hidden"><div id="breakout-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div></div>
        <div id="all-section" class="hidden">
            <div class="bg-gray-900 rounded-xl overflow-hidden border border-gray-800">
                <table class="w-full text-left text-xs"><tbody id="full-tbody" class="divide-y divide-gray-800"></tbody></table>
            </div>
        </div>
    </div>

    <script>
        // ======= [æ ¸å¿ƒè¨­å®šï¼šè«‹å¡«å¯«ä½ çš„ Telegram è³‡è¨Š] =======
        const TG_TOKEN = '8553267999:AAH7HNz5If0I52bjxLpbrufB-eAqZ8kSTi0'; 
        const TG_CHAT_ID = '5671018133'; 
        // =================================================

        let sentSignals = new Set(); // ç”¨ä¾†é˜²æ­¢é‡è¤‡ç™¼é€é€šçŸ¥

        async function sendToTelegram(message) {
            if (TG_TOKEN.includes('ä½ çš„')) return; // è‹¥æ²’è¨­å®šå‰‡ä¸åŸ·è¡Œ
            const url = `https://api.telegram.org/bot${TG_TOKEN}/sendMessage?chat_id=${TG_CHAT_ID}&text=${encodeURIComponent(message)}`;
            try { await fetch(url); } catch (e) { console.error("TG ç™¼é€å¤±æ•—", e); }
        }

        async function analyze() {
            const capital = parseFloat(document.getElementById('total-capital').value) || 0;
            const res = await fetch('https://api.binance.com/api/v3/ticker/24hr');
            const data = await res.json();
            const top50 = data.filter(d => d.symbol.endsWith('USDT')).sort((a, b) => b.quoteVolume - a.quoteVolume).slice(0, 50);

            const bulls = top50.filter(c => parseFloat(c.priceChangePercent) > 0).length;
            document.getElementById('bull-bar').style.width = `${(bulls/50)*100}%`;
            document.getElementById('market-status-text').innerText = bulls > 30 ? "âš–ï¸ å¤šé ­ä½”å„ª" : "âš–ï¸ ç©ºé ­ä½”å„ª";

            const lists = { oversold: document.getElementById('oversold-list'), breakout: document.getElementById('breakout-list') };
            lists.oversold.innerHTML = ''; lists.breakout.innerHTML = '';
            document.getElementById('full-tbody').innerHTML = '';

            for (let coin of top50) {
                try {
                    const kRes = await fetch(`https://api.binance.com/api/v3/klines?symbol=${coin.symbol}&interval=1h&limit=200`);
                    const kData = await kRes.json();
                    const closes = kData.map(d => parseFloat(d[4]));
                    const volumes = kData.map(d => parseFloat(d[5]));
                    const price = closes[closes.length - 1];

                    const rsi = calcRSI(closes);
                    const ema200 = calcEMA(closes, 200);
                    const isAboveEMA = price > ema200;
                    const volConfirm = volumes[volumes.length - 1] > (volumes.slice(-20).reduce((a,b)=>a+b)/20) * 1.5;
                    const suggestAmount = (capital * 0.15).toFixed(2);
                    const isSafe = volConfirm && isAboveEMA;

                    // 1. è™•ç†é€šçŸ¥é‚è¼¯
                    if (isSafe && (rsi < 32 || rsi > 68)) {
                        if (!sentSignals.has(coin.symbol)) {
                            const msg = `ğŸ’ é»ƒé‡‘æ©Ÿæœƒï¼\nå¹£ç¨®ï¼š${coin.symbol}\nåƒ¹éŒ¢ï¼š$${price}\nå»ºè­°è²·å…¥ï¼š$${suggestAmount} USDT\nè·¯æ³ï¼š${isAboveEMA?'âœ…ä¸Šå¡':'âŒä¸‹å¡'}\næ²¹é‡ï¼š${volConfirm?'âœ…å……è¶³':'âŒæ²’æ²¹'}`;
                            sendToTelegram(msg);
                            sentSignals.add(coin.symbol);
                            setTimeout(() => sentSignals.delete(coin.symbol), 3600000); // ä¸€å°æ™‚å¾Œå¯å†æ¬¡é€šçŸ¥
                        }
                    }

                    // 2. æ¸²æŸ“ UI
                    const cardHtml = createCard(coin.symbol, price, suggestAmount, rsi < 32, volConfirm, isAboveEMA);
                    if (rsi < 32) lists.oversold.innerHTML += cardHtml;
                    if (rsi > 68 && volConfirm) lists.breakout.innerHTML += cardHtml;

                    document.getElementById('full-tbody').innerHTML += `
                        <tr class="p-4 border-b border-gray-800">
                            <td class="p-4 font-bold text-yellow-500">${coin.symbol}</td>
                            <td class="p-4">$${price}</td>
                            <td class="p-4 ${isAboveEMA?'text-green-500':'text-red-500'}">${isAboveEMA?'âœ…å®‰å…¨':'âŒå±éšª'}</td>
                        </tr>`;
                } catch(e) {}
            }
        }

        function createCard(symbol, price, amount, isOversold, volConfirm, isAboveEMA) {
            const isSafe = volConfirm && isAboveEMA;
            const tp1 = (price * 1.04).toFixed(4);
            const stop = (price * 0.97).toFixed(4);
            return `
                <div class="bg-gray-900 border-2 ${isSafe ? 'border-green-500 shadow-green-900/20' : 'border-yellow-600'} p-6 rounded-2xl shadow-xl relative overflow-hidden">
                    ${isSafe ? '<div class="absolute top-0 right-0 bg-green-500 text-black px-4 py-1 text-[10px] font-black blink italic">RECOMMENDED</div>' : ''}
                    <h3 class="text-2xl font-black mb-4">${symbol}</h3>
                    <div class="bg-yellow-500/10 border border-yellow-500/50 p-4 rounded-xl mb-6">
                        <p class="text-[10px] text-yellow-500 font-bold mb-1">ğŸ’° æ¨è–¦æŠ•å…¥é‡‘é¡</p>
                        <p class="text-3xl font-black">$ ${amount}</p>
                    </div>
                    <div class="space-y-3 text-sm mb-6 border-b border-gray-800 pb-4">
                        <div class="flex justify-between text-red-500 font-bold italic"><span>ğŸš¨ ä¿å‘½åœæ:</span><span>$${stop}</span></div>
                        <div class="flex justify-between text-green-400"><span>âœ… ç¬¬ä¸€ç«™åœåˆ©:</span><span>$${tp1}</span></div>
                    </div>
                    <div class="bg-black/40 p-3 rounded-lg text-[11px] space-y-2">
                        <div class="flex justify-between"><span>ğŸš¦ å¤§ç’°å¢ƒ:</span><b class="${isAboveEMA?'text-green-500':'text-red-500'}">${isAboveEMA?'å®‰å…¨ä¸Šå¡':'å±éšªä¸‹å¡'}</b></div>
                        <div class="flex justify-between"><span>â›½ å¼•æ“å‹•åŠ›:</span><b class="${volConfirm?'text-green-500':'text-red-500'}">${volConfirm?'å‹•åŠ›å……è¶³':'å‹•åŠ›ä¸è¶³'}</b></div>
                    </div>
                </div>`;
        }

        function calcRSI(prices) {
            let g=0, l=0;
            for(let i=prices.length-14; i<prices.length; i++) {
                let d=prices[i]-prices[i-1];
                d>=0 ? g+=d : l-=d;
            }
            return 100 - (100/(1+(g/14)/(l/14)));
        }

        function calcEMA(prices, period) {
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) ema = (prices[i] * k) + (ema * (1 - k));
            return ema;
        }

        function switchTab(tab) {
            ['oversold', 'breakout', 'all'].forEach(t => {
                document.getElementById(`${t}-section`).classList.toggle('hidden', t !== tab);
                document.getElementById(`btn-${t}`).classList.toggle('tab-active', t === tab);
                document.getElementById(`btn-${t}`).classList.toggle('text-gray-500', t !== tab);
            });
        }

        window.onload = analyze;
        setInterval(analyze, 300000); // 5åˆ†é˜åˆ·æ–°ä¸€æ¬¡
    </script>
</body>
</html>
