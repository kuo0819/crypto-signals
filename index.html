<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ å¯†è²¨å¹£æ–°æ‰‹æŠ•è³‡æ±ºç­–å°èˆª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; }
        .blink-border { animation: blink 1.5s infinite; }
        @keyframes blink { 0% { border-color: #ef4444; box-shadow: 0 0 10px #ef4444; } 50% { border-color: #475569; box-shadow: none; } 100% { border-color: #ef4444; box-shadow: 0 0 10px #ef4444; } }
    </style>
</head>
<body class="bg-gray-950 text-white p-4">

    <header class="max-w-6xl mx-auto mb-6 border-b border-yellow-600 pb-4">
        <h1 class="text-3xl font-bold text-yellow-500 text-center md:text-left">å°ˆæ¥­æ“ç›¤æ‰‹æ±ºç­–ç³»çµ± (æ–°æ‰‹å°ˆç”¨ç‰ˆ)</h1>
        <p class="text-gray-400 text-sm mt-2 text-center md:text-left">è‡ªå‹•ç›£æ§å¸‚å ´å‰ 50 åå¤§äº¤æ˜“é‡è²¨å¹£ï¼Œæ‰¾å°‹ã€Œè¶…è·Œåå½ˆã€æ©Ÿæœƒ</p>
    </header>

    <main class="max-w-6xl mx-auto">
        <section id="trading-rules" class="mb-8 bg-gray-900 border-l-8 border-yellow-600 p-5 rounded-r-lg shadow-lg">
            <h2 class="text-xl font-bold text-yellow-500 mb-3 underline">âš ï¸ æ–°æ‰‹ä¿å‘½ä¸‰æ¢éµå¾‹ (ä¸€å®šè¦çœ‹)</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="bg-black/40 p-3 rounded border border-gray-800">
                    <b class="text-yellow-400 block mb-1">1. æ²’è¨Šè™Ÿä¸é€²å ´</b>
                    <span>ä¸‹æ–¹å‡ºç¾ã€Œé€²å ´å»ºè­°ã€æ‰è€ƒæ…®ï¼Œç¦æ­¢æ†‘æ„Ÿè¦ºè²·å¹£ã€‚</span>
                </div>
                <div class="bg-black/40 p-3 rounded border border-gray-800">
                    <b class="text-red-500 block mb-1">2. åœæè¦æœæ–·</b>
                    <span>è·Œåˆ°ç³»çµ±æ¨™è¨»çš„ã€Œåœæåƒ¹ã€ä¸€å®šè¦è³£ï¼Œä¸èƒ½ç­‰å®ƒæ¼²å›ä¾†ã€‚</span>
                </div>
                <div class="bg-black/40 p-3 rounded border border-gray-800">
                    <b class="text-blue-400 block mb-1">3. åˆ†æ•£æŠ•éŒ¢</b>
                    <span>ä¸è¦ä¸€æ¬¡æŠŠéŒ¢å…¨éƒ¨æŠ•åœ¨åŒä¸€å€‹å¹£ä¸Šï¼Œè‡³å°‘åˆ†ä¸‰ä»½ã€‚</span>
                </div>
            </div>
        </section>

        <section class="mb-10">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold text-red-500">ğŸ”¥ çµç‰©å‡ºç¾ï¼šä»Šæ—¥é€²å ´å»ºè­°</h2>
                <span id="update-time" class="text-xs text-gray-500 italic">æ­£åœ¨æƒæå¸‚å ´...</span>
            </div>
            <div id="top-picks" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
            <div id="no-signal" class="hidden p-8 bg-gray-900/50 rounded-xl text-center text-gray-500 border border-dashed border-gray-700">
                ç›®å‰ 50 å€‹ä¸»è¦å¹£ç¨®éƒ½æ²’å‡ºç¾ã€Œè¶…è·Œåå½ˆã€è¨Šè™Ÿï¼Œè«‹ç¹¼çºŒè€å¿ƒç­‰å¾…ã€‚
            </div>
        </section>

        <section>
            <h2 class="text-xl font-bold mb-4 text-blue-400">ğŸ“Š 50 å¼·è²¨å¹£å³æ™‚ç‹€æ…‹</h2>
            <div class="bg-gray-900 rounded-lg overflow-hidden border border-gray-800">
                <table class="w-full text-left text-sm">
                    <thead class="bg-gray-800 text-gray-300">
                        <tr>
                            <th class="p-3">è²¨å¹£åç¨±</th>
                            <th class="p-3">ç›®å‰åƒ¹æ ¼</th>
                            <th class="p-3 text-center">å¸‚å ´ç†±åº¦(RSI)</th>
                            <th class="p-3">æ±ºç­–å»ºè­°</th>
                            <th class="p-3 text-right">ç›®æ¨™(åœåˆ©/åœæ)</th>
                        </tr>
                    </thead>
                    <tbody id="market-list" class="divide-y divide-gray-800 font-mono">
                        </tbody>
                </table>
            </div>
        </section>
    </main>

    <script>
        async function runAnalysis() {
            const list = document.getElementById('market-list');
            const picks = document.getElementById('top-picks');
            const rules = document.getElementById('trading-rules');
            
            try {
                // ç²å–å‰ 50 åäº¤æ˜“é‡çš„ USDT äº¤æ˜“å°
                const tickerRes = await fetch('https://api.binance.com/api/v3/ticker/24hr');
                const allData = await tickerRes.json();
                const top50 = allData
                    .filter(d => d.symbol.endsWith('USDT'))
                    .sort((a, b) => parseFloat(b.quoteVolume) - parseFloat(a.quoteVolume))
                    .slice(0, 50);

                list.innerHTML = '';
                picks.innerHTML = '';
                let hasSignal = false;

                for (let i = 0; i < top50.length; i++) {
                    const coin = top50[i];
                    try {
                        const kRes = await fetch(`https://api.binance.com/api/v3/klines?symbol=${coin.symbol}&interval=1h&limit=30`);
                        const kData = await kRes.json();
                        const closes = kData.map(d => parseFloat(d[4]));
                        const price = closes[closes.length - 1];
                        
                        // è¨ˆç®—æŒ‡æ¨™
                        const rsi = calcRSI(closes);
                        const bbLow = calcBBLow(closes); // åœ°æ¿åƒ¹
                        const bbHigh = calcBBHigh(closes); // å¤©èŠ±æ¿åƒ¹

                        const isTop10 = i < 10;
                        const isSuperCold = rsi < 30 && price <= bbLow; // è¶…å†·ä»£è¡¨è¶…è·Œ
                        const isTooHot = rsi > 70 || price >= bbHigh; // å¤ªç†±ä»£è¡¨è¶…æ¼²

                        if (isSuperCold) {
                            hasSignal = true;
                            picks.innerHTML += `
                                <div class="bg-gray-800 border-2 border-green-500 p-5 rounded-xl shadow-lg relative">
                                    <div class="flex justify-between items-start mb-3">
                                        <span class="text-2xl font-black">${coin.symbol}</span>
                                        ${isTop10 ? '<span class="bg-yellow-500 text-black text-[10px] px-2 py-0.5 rounded font-bold">æ–°æ‰‹é¦–é¸</span>' : ''}
                                    </div>
                                    <div class="space-y-1 mb-4 text-sm">
                                        <p class="text-green-400">å¯ä»¥é€²å ´: <span class="font-bold font-mono">$${price}</span></p>
                                        <p class="text-yellow-400">åœåˆ©ç›®æ¨™: <span class="font-bold font-mono">$${(price * 1.05).toFixed(4)}</span></p>
                                        <p class="text-red-500 font-bold underline">åœæåƒ¹: $${(price * 0.97).toFixed(4)}</p>
                                    </div>
                                    <p class="text-[10px] text-gray-500 italic">åˆ†æï¼šå¸‚å ´æ¥µåº¦ææ…Œï¼Œåƒ¹æ ¼è·Œåˆ°åœ°æ¿å€ï¼Œé æœŸæœ‰åå½ˆã€‚</p>
                                </div>`;
                        }

                        let statusColor = "text-gray-500";
                        let statusText = "æŒå¹£è§€æœ›";
                        if (isSuperCold) { statusColor = "text-green-400 font-bold"; statusText = "ğŸ”µ å»ºè­°è²·å…¥"; }
                        else if (isTooHot) { statusColor = "text-red-400"; statusText = "ğŸ”´ å»ºè­°è³£å‡º"; }

                        let heatText = rsi < 35 ? "ä½æº«(å†·)" : (rsi > 65 ? "é«˜æº«(ç†±)" : "é©ä¸­");

                        list.innerHTML += `
                            <tr class="${isSuperCold ? 'bg-green-900/20' : ''} hover:bg-gray-800">
                                <td class="p-3">
                                    <span class="text-gray-600 text-[10px] mr-1">${i+1}.</span>
                                    <span class="${isTop10 ? 'text-yellow-500 font-bold' : 'text-blue-300'}">${coin.symbol}</span>
                                </td>
                                <td class="p-3 text-white font-mono">$${price}</td>
                                <td class="p-3 text-center text-xs">
                                    <div class="text-gray-400">${heatText}</div>
                                    <div class="text-[10px] text-gray-600">${rsi.toFixed(1)}</div>
                                </td>
                                <td class="p-3 ${statusColor}">${statusText}</td>
                                <td class="p-3 text-right text-[10px] text-gray-400">
                                    åˆ©: ${(price * 1.05).toFixed(2)}<br>æ: ${(price * 0.97).toFixed(2)}
                                </td>
                            </tr>`;
                    } catch (e) { continue; }
                }

                document.getElementById('no-signal').classList.toggle('hidden', hasSignal);
                rules.className = hasSignal ? "mb-8 bg-gray-900 border-l-8 border-red-600 p-5 rounded-r-lg shadow-lg blink-border" : "mb-8 bg-gray-900 border-l-8 border-yellow-600 p-5 rounded-r-lg shadow-lg";
                document.getElementById('update-time').innerText = "æœ€å¾Œæ›´æ–°æ™‚é–“: " + new Date().toLocaleTimeString();

            } catch (err) { console.error(err); }
        }

        function calcRSI(prices, p=14) {
            let g=0, l=0;
            for(let i=prices.length-p; i<prices.length; i++) {
                let d = prices[i]-prices[i-1];
                d >= 0 ? g+=d : l-=d;
            }
            return 100 - (100 / (1 + (g/p)/(l/p)));
        }

        function calcBBLow(prices, p=20) {
            const s = prices.slice(-p);
            const m = s.reduce((a,b)=>a+b)/p;
            const d = Math.sqrt(s.map(x=>Math.pow(x-m,2)).reduce((a,b)=>a+b)/p);
            return m - (d * 2);
        }
        
        function calcBBHigh(prices, p=20) {
            const s = prices.slice(-p);
            const m = s.reduce((a,b)=>a+b)/p;
            const d = Math.sqrt(s.map(x=>Math.pow(x-m,2)).reduce((a,b)=>a+b)/p);
            return m + (d * 2);
        }

        runAnalysis();
        setInterval(runAnalysis, 300000); // 5åˆ†é˜è‡ªå‹•æƒæä¸€æ¬¡
    </script>
</body>
</html>
